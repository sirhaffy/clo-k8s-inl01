apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: mongodb-external-secret
  namespace: {{ .Values.namespace | default "todo-app" }}
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: azure-keyvault-store        # Name of the SecretStore
    kind: SecretStore
  target:
    name: mongodb-secret              # Name of the Kubernetes Secret to create
    creationPolicy: Owner             # Delete the secret when the ExternalSecret is deleted
  data:
  - secretKey: root-password          # Key in the Kubernetes Secret
    remoteRef:
      key: mongodb-root-password      # Key Vault secret name
  - secretKey: connection-string      # Key in the Kubernetes Secret
    remoteRef:
      key: mongodb-connection-string  # Key Vault secret name